ADR-0103: Session Lifecycle Boundaries â€” Unframed vs Framed Traffic and Responsibilities

Status: Accepted
Date: 2025-12-23

Context
The E27 connection includes both unframed plaintext JSON and framed encrypted traffic. Additionally, API_LINK is a one-time pairing step, while HELLO is per-connection.

Decision
1) Traffic boundaries:
   - Unframed plaintext JSON:
       - Discovery (ELKWC2017 Hello)
       - API_LINK request (client -> panel) is unframed plaintext JSON
       - HELLO request/response is unframed plaintext JSON (response contains encrypted key material fields)
   - Framed schema-0 encrypted traffic:
       - AUTHENTICATE and subsequent operational messages (e.g., area.get_status)

2) Responsibility boundaries:
   - linking.py:
       - Performs API_LINK exchange given discovery nonce and user-provided credentials.
   - hello.py:
       - Performs HELLO exchange given link credentials.
   - session.py:
       - Owns sequencing, connection lifecycle, timeouts, and callbacks.
       - Owns receive pump: routing inbound bytes to either:
           a) unframed JSON receiver (when in discovery/link
