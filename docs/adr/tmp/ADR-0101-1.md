ADR-0101: E27 Schema-0 Envelope Semantics

Status: Accepted

Context
After E27 session establishment, application messages are exchanged using
an encrypted envelope referred to as "schema-0". Correct interpretation of
this envelope is required for authentication, command dispatch, and state
updates.

Decision
The schema-0 envelope semantics are defined as follows:

1. Envelope Structure (pre-framing)
   - Protocol byte:
       - Identifies encrypted schema-0 traffic
   - Encrypted payload:
       - AES-encrypted JSON bytes
       - Includes sequence numbers and message content

2. Encryption Semantics
   - AES is used with:
       - Session key derived during hello exchange
       - Deterministic padding rules defined by the protocol
   - Decryption failure results in message rejection but does not
     terminate the session.

3. JSON Semantics
   - The decrypted payload is UTF-8 JSON
   - Sequence numbers are application-level (distinct from framing)
   - Message routing is based on JSON domain/method keys

4. Envelope Scope
   - Schema-0 applies ONLY after successful hello/authenticate
   - Discovery and api_link traffic is explicitly unencrypted

Consequences
- Encryption is orthogonal to framing.
- Framing correctness is required before decryption is attempted.
- Application dispatch operates strictly on decrypted JSON.
