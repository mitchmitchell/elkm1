{"run_id": "783d6b8218ea480db768645c506c3f36", "test_id": "test/test_e27_hello_roundtrip.py::test_hello_roundtrip_socketpair", "record_type": "test_start", "t_ms": 0, "ts_utc": "2025-12-27T00:25:39Z", "meta": {"pid": 68515}}
{"run_id": "783d6b8218ea480db768645c506c3f36", "test_id": "test/test_e27_hello_roundtrip.py::test_hello_roundtrip_socketpair", "record_type": "test_end", "t_ms": 13, "ts_utc": "2025-12-27T00:25:39Z", "outcome": "fail", "error": {"when": "call", "longrepr": "def test_hello_roundtrip_socketpair() -> None:\n        identity = E27Identity(mn=\"0222\", sn=\"001122334455\", fwver=\"1.0\", hwver=\"1.0\", osver=\"1.0\")\n        linkkey_hex = \"00112233445566778899aabbccddeeff\"\n        session_id = 12345\n        session_key = os.urandom(16)\n        hmac_key = os.urandom(32)\n    \n        sk_hex = _encrypt_key_field(linkkey_hex=linkkey_hex, plaintext=session_key)\n        shm_hex = _encrypt_key_field(linkkey_hex=linkkey_hex, plaintext=hmac_key)\n    \n        hello_response = json.dumps(\n            {\n                \"hello\": {\n                    \"session_id\": session_id,\n                    \"sk\": sk_hex,\n                    \"shm\": shm_hex,\n                    \"error_code\": 0,\n                }\n            },\n            separators=(\",\", \":\"),\n        ).encode(\"utf-8\")\n    \n        client, server = socket.socketpair()\n    \n        def _server() -> None:\n            try:\n                server.recv(4096)\n                server.sendall(hello_response)\n            finally:\n                server.close()\n    \n        thread = threading.Thread(target=_server, daemon=True)\n        thread.start()\n    \n        try:\n            keys = perform_hello(sock=client, identity=identity, linkkey_hex=linkkey_hex, seq=110, timeout_s=2.0)\n        finally:\n            client.close()\n            thread.join(timeout=1.0)\n    \n        assert keys.session_id == session_id\n>       assert bytes.fromhex(keys.session_key_hex) == session_key\nE       AssertionError: assert b'5\\xc4\\xe8\\x...\\x82&\\x7f\\x0e' == b'\\xfe\\xe8\\xc...\\x0e\\x7f&\\x82'\nE         \nE         At index 0 diff: b'5' != b'\\xfe'\nE         Use -v to get more diff\n\ntest/test_e27_hello_roundtrip.py:63: AssertionError"}}
